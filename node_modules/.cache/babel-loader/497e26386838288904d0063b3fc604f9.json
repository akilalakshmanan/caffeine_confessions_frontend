{"ast":null,"code":"import _objectSpread from\"/home/akila/Desktop/Caffeine_Confessions_SPE_Final_Project/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/home/akila/Desktop/Caffeine_Confessions_SPE_Final_Project/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _regeneratorRuntime from\"/home/akila/Desktop/Caffeine_Confessions_SPE_Final_Project/frontend/node_modules/@babel/runtime/regenerator/index.js\";import{useContext}from'react';import{Store}from'../Store';import{Helmet}from'react-helmet-async';import Row from'react-bootstrap/Row';import Col from'react-bootstrap/Col';import MessageBox from'../components/MessageBox';import ListGroup from'react-bootstrap/ListGroup';import Button from'react-bootstrap/Button';import Card from'react-bootstrap/Card';import{Link,useNavigate}from'react-router-dom';import axios from'axios';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function CartScreen(){var navigate=useNavigate();var _useContext=useContext(Store),state=_useContext.state,ctxDispatch=_useContext.dispatch;var cartItems=state.cart.cartItems;var getPriceIdAndQuantity=function getPriceIdAndQuantity(cartItems){console.log(cartItems);var priceId='';cartItems.forEach(function(item){if(priceId!==''){priceId+='|'+item.priceIdStripe+\"::\"+item.quantity;}else{priceId=item.priceIdStripe+\"::\"+item.quantity;}});return priceId;};var updateCartHandler=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(item,quantity){var instance,_yield$instance$get,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:instance=axios.create({baseURL:\"http://localhost:5000\"});_context.next=3;return instance.get(\"/api/products/\".concat(item._id));case 3:_yield$instance$get=_context.sent;data=_yield$instance$get.data;if(!(data.countInStock<quantity)){_context.next=8;break;}window.alert('Sorry. Product is out of stock');return _context.abrupt(\"return\");case 8:ctxDispatch({type:'CART_ADD_ITEM',payload:_objectSpread(_objectSpread({},item),{},{quantity:quantity})});case 9:case\"end\":return _context.stop();}}},_callee);}));return function updateCartHandler(_x,_x2){return _ref.apply(this,arguments);};}();var removeItemHandler=function removeItemHandler(item){ctxDispatch({type:'CART_REMOVE_ITEM',payload:item});};var checkoutHandler=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(event){var instance,response;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:event.preventDefault();_context2.prev=1;instance=axios.create({baseURL:\"http://localhost:5000\"});_context2.next=5;return instance.post(\"/create-checkout-session\");case 5:response=_context2.sent;// const resJson = response.json();\nif(response.status===303){console.log('responseresponse',response);}else{console.log('responseresponseresponse',response);}// if (data.countInStock < quantity) {\n//   window.alert('Sorry. Product is out of stock');\n//   return;\n// }\nwindow.location.assign(response.request.responseURL);_context2.next=13;break;case 10:_context2.prev=10;_context2.t0=_context2[\"catch\"](1);console.log(_context2.t0);case 13:case\"end\":return _context2.stop();}}},_callee2,null,[[1,10]]);}));return function checkoutHandler(_x3){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Helmet,{children:/*#__PURE__*/_jsx(\"title\",{children:\"Shopping Cart\"})}),/*#__PURE__*/_jsx(\"h1\",{children:\"Shopping Cart\"}),/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{md:8,children:cartItems.length===0?/*#__PURE__*/_jsxs(MessageBox,{children:[\"Cart is empty. \",/*#__PURE__*/_jsx(Link,{to:\"/\",children:\"Go Shopping\"})]}):/*#__PURE__*/_jsx(ListGroup,{children:cartItems.map(function(item){return/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(Row,{className:\"align-items-center\",children:[/*#__PURE__*/_jsxs(Col,{md:4,children:[/*#__PURE__*/_jsx(\"img\",{src:item.image,alt:item.name,className:\"img-fluid rounded img-thumbnail\"}),' ',/*#__PURE__*/_jsx(Link,{to:\"/product/\".concat(item.slug),children:item.name})]}),/*#__PURE__*/_jsxs(Col,{md:3,children:[/*#__PURE__*/_jsx(Button,{onClick:function onClick(){return updateCartHandler(item,item.quantity-1);},variant:\"light\",disabled:item.quantity===1,children:\"minus one\"}),' ',/*#__PURE__*/_jsx(\"span\",{children:item.quantity}),' ',/*#__PURE__*/_jsx(Button,{variant:\"light\",onClick:function onClick(){return updateCartHandler(item,item.quantity+1);},disabled:item.quantity===item.countInStock,children:\"add one\"})]}),/*#__PURE__*/_jsxs(Col,{md:3,children:[\"$\",item.price]}),/*#__PURE__*/_jsx(Col,{md:2,children:/*#__PURE__*/_jsx(Button,{onClick:function onClick(){return removeItemHandler(item);},variant:\"light\",children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-trash\"})})})]})},item._id);})})}),/*#__PURE__*/_jsx(Col,{md:4,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(Card.Body,{children:/*#__PURE__*/_jsxs(ListGroup,{variant:\"flush\",children:[/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(\"h3\",{children:[\"Subtotal (\",cartItems.reduce(function(a,c){return a+c.quantity;},0),' ',\"items) : $\",cartItems.reduce(function(a,c){return a+c.price*c.quantity;},0)]})}),/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(\"form\",{action:\"/create-checkout-session\",method:\"POST\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"hidden\",name:\"priceIdAQuantity\",value:getPriceIdAndQuantity(cartItems)}),/*#__PURE__*/_jsx(\"div\",{className:\"d-grid\",children:/*#__PURE__*/_jsx(Button,{type:\"submit\",variant:\"primary\"// onClick={checkoutHandler}\n,disabled:cartItems.length===0,children:\"Proceed to Checkout\"})})]})})]})})})})]})]});}","map":{"version":3,"sources":["/home/akila/Desktop/Caffeine_Confessions_SPE_Final_Project/frontend/src/screens/CartScreen.js"],"names":["useContext","Store","Helmet","Row","Col","MessageBox","ListGroup","Button","Card","Link","useNavigate","axios","CartScreen","navigate","state","ctxDispatch","dispatch","cartItems","cart","getPriceIdAndQuantity","console","log","priceId","forEach","item","priceIdStripe","quantity","updateCartHandler","instance","create","baseURL","get","_id","data","countInStock","window","alert","type","payload","removeItemHandler","checkoutHandler","event","preventDefault","post","response","status","location","assign","request","responseURL","length","map","image","name","slug","price","reduce","a","c"],"mappings":"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","sourcesContent":["import { useContext } from 'react';\nimport { Store } from '../Store';\nimport { Helmet } from 'react-helmet-async';\nimport Row from 'react-bootstrap/Row';\nimport Col from 'react-bootstrap/Col';\nimport MessageBox from '../components/MessageBox';\nimport ListGroup from 'react-bootstrap/ListGroup';\nimport Button from 'react-bootstrap/Button';\nimport Card from 'react-bootstrap/Card';\nimport { Link, useNavigate } from 'react-router-dom';\nimport axios from 'axios';\n\nexport default function CartScreen() {\n  const navigate = useNavigate();\n  const { state, dispatch: ctxDispatch } = useContext(Store);\n  const {\n    cart: { cartItems },\n  } = state;\n\n  const getPriceIdAndQuantity = (cartItems) => {\n    console.log(cartItems);\n    let priceId = '';\n    cartItems.forEach((item) => {\n      if (priceId !== '') {\n        priceId += '|' + item.priceIdStripe + \"::\" + item.quantity\n      } else {\n        priceId = item.priceIdStripe + \"::\" + item.quantity\n      }\n    })\n    return priceId\n  }\n\n  const updateCartHandler = async (item, quantity) => {\n    const instance = axios.create({baseURL:\"http://localhost:5000\"})\n    const { data } = await instance.get(`/api/products/${item._id}`);\n    if (data.countInStock < quantity) {\n      window.alert('Sorry. Product is out of stock');\n      return;\n    }\n    ctxDispatch({\n      type: 'CART_ADD_ITEM',\n      payload: { ...item, quantity },\n    });\n  };\n  const removeItemHandler = (item) => {\n    ctxDispatch({ type: 'CART_REMOVE_ITEM', payload: item });\n  };\n\n  const checkoutHandler = async (event) => {\n    event.preventDefault();\n    try{\n      const instance = axios.create({baseURL:\"http://localhost:5000\"})\n      const response = await instance.post(`/create-checkout-session`);\n      // const resJson = response.json();\n      if (response.status === 303) {\n        console.log('responseresponse',response);\n      }else{\n        console.log('responseresponseresponse',response);\n      }\n      // if (data.countInStock < quantity) {\n      //   window.alert('Sorry. Product is out of stock');\n      //   return;\n      // }\n      window.location.assign(response.request.responseURL);\n    }catch (error){\n      console.log(error)\n    }\n  };\n\n  return (\n    <div>\n      <Helmet>\n        <title>Shopping Cart</title>\n      </Helmet>\n      <h1>Shopping Cart</h1>\n      <Row>\n        <Col md={8}>\n          {cartItems.length === 0 ? (\n            <MessageBox>\n              Cart is empty. <Link to=\"/\">Go Shopping</Link>\n            </MessageBox>\n          ) : (\n            <ListGroup>\n              {cartItems.map((item) => (\n                <ListGroup.Item key={item._id}>\n                  <Row className=\"align-items-center\">\n                    <Col md={4}>\n                      <img\n                        src={item.image}\n                        alt={item.name}\n                        className=\"img-fluid rounded img-thumbnail\"\n                      ></img>{' '}\n                      <Link to={`/product/${item.slug}`}>{item.name}</Link>\n                    </Col>\n                    <Col md={3}>\n                      <Button\n                        onClick={() =>\n                          updateCartHandler(item, item.quantity - 1)\n                        }\n                        variant=\"light\"\n                        disabled={item.quantity === 1}\n                      >\n                          minus one\n                        {/* <i className=\"fas fa-minus-circle\"></i> */}\n                      </Button>{' '}\n                      <span>{item.quantity}</span>{' '}\n                      <Button\n                        variant=\"light\"\n                        onClick={() =>\n                          updateCartHandler(item, item.quantity + 1)\n                        }\n                        disabled={item.quantity === item.countInStock}\n                      >\n                          add one\n                        {/* <i className=\"fas fa-plus-circle\"></i> */}\n                      </Button>\n                    </Col>\n                    <Col md={3}>${item.price}</Col>\n                    <Col md={2}>\n                      <Button\n                        onClick={() => removeItemHandler(item)}\n                        variant=\"light\"\n                      >\n                        <i className=\"fas fa-trash\"></i>\n                      </Button>\n                    </Col>\n                  </Row>\n                </ListGroup.Item>\n              ))}\n            </ListGroup>\n          )}\n        </Col>\n        <Col md={4}>\n          <Card>\n            <Card.Body>\n              <ListGroup variant=\"flush\">\n                <ListGroup.Item>\n                  <h3>\n                    Subtotal ({cartItems.reduce((a, c) => a + c.quantity, 0)}{' '}\n                    items) : $\n                    {cartItems.reduce((a, c) => a + c.price * c.quantity, 0)}\n                  </h3>\n                </ListGroup.Item>\n                <ListGroup.Item>\n                  <form action=\"/create-checkout-session\" method='POST'>\n                  <input type=\"hidden\" name=\"priceIdAQuantity\" value={getPriceIdAndQuantity(cartItems)} />\n                  <div className=\"d-grid\">\n                    <Button\n                      type=\"submit\"\n                      variant=\"primary\"\n                      // onClick={checkoutHandler}\n                      disabled={cartItems.length === 0}\n                    >\n                      Proceed to Checkout\n                    </Button>\n                  </div>\n                  </form>\n                </ListGroup.Item>\n              </ListGroup>\n            </Card.Body>\n          </Card>\n        </Col>\n      </Row>\n    </div>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}