{"ast":null,"code":"import _toConsumableArray from\"/home/akila/Desktop/Caffeine_Confessions_SPE_Final_Project/frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _asyncToGenerator from\"/home/akila/Desktop/Caffeine_Confessions_SPE_Final_Project/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/akila/Desktop/Caffeine_Confessions_SPE_Final_Project/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _objectSpread from\"/home/akila/Desktop/Caffeine_Confessions_SPE_Final_Project/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _regeneratorRuntime from\"/home/akila/Desktop/Caffeine_Confessions_SPE_Final_Project/frontend/node_modules/@babel/runtime/regenerator/index.js\";import React,{useEffect,useReducer,useState}from'react';import{Link,useNavigate,useLocation}from'react-router-dom';import axios from'axios';import{toast}from'react-toastify';import{getError}from'../utils';import{Helmet}from'react-helmet-async';import Row from'react-bootstrap/Row';import Col from'react-bootstrap/Col';// import Rating from '../components/Rating';\nimport LoadingBox from'../components/LoadingBox';import MessageBox from'../components/MessageBox';import Button from'react-bootstrap/Button';import Product from'../components/Product';import LinkContainer from'react-router-bootstrap/LinkContainer';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var reducer=function reducer(state,action){switch(action.type){case'FETCH_REQUEST':return _objectSpread(_objectSpread({},state),{},{loading:true});case'FETCH_SUCCESS':return _objectSpread(_objectSpread({},state),{},{products:action.payload.products,page:action.payload.page,pages:action.payload.pages,countProducts:action.payload.countProducts,loading:false});case'FETCH_FAIL':return _objectSpread(_objectSpread({},state),{},{loading:false,error:action.payload});default:return state;}};var prices=[{name:'$1 to $50',value:'1-50'},{name:'$51 to $200',value:'51-200'},{name:'$201 to $1000',value:'201-1000'}];// export const ratings = [\n//   {\n//     name: '4stars & up',\n//     rating: 4,\n//   },\n//   {\n//     name: '3stars & up',\n//     rating: 3,\n//   },\n//   {\n//     name: '2stars & up',\n//     rating: 2,\n//   },\n//   {\n//     name: '1stars & up',\n//     rating: 1,\n//   },\n// ];\nexport default function SearchScreen(){var navigate=useNavigate();var _useLocation=useLocation(),search=_useLocation.search;var sp=new URLSearchParams(search);// /search?category=Shirts\nvar category=sp.get('category')||'all';var query=sp.get('query')||'all';var price=sp.get('price')||'all';// const rating = sp.get('rating') || 'all';\nvar order=sp.get('order')||'newest';var page=sp.get('page')||1;var _useReducer=useReducer(reducer,{loading:true,error:''}),_useReducer2=_slicedToArray(_useReducer,2),_useReducer2$=_useReducer2[0],loading=_useReducer2$.loading,error=_useReducer2$.error,products=_useReducer2$.products,pages=_useReducer2$.pages,countProducts=_useReducer2$.countProducts,dispatch=_useReducer2[1];useEffect(function(){var fetchData=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var instance,_yield$instance$get,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;instance=axios.create({baseURL:\"http://localhost:5000\"});_context.next=4;return instance.get(// `/api/products/search?page=${page}&query=${query}&category=${category}&price=${price}&rating=${rating}&order=${order}`\n\"/api/products/search?page=\".concat(page,\"&query=\").concat(query,\"&category=\").concat(category,\"&price=\").concat(price,\"&order=\").concat(order));case 4:_yield$instance$get=_context.sent;data=_yield$instance$get.data;dispatch({type:'FETCH_SUCCESS',payload:data});_context.next=12;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](0);dispatch({type:'FETCH_FAIL',payload:getError(error)});case 12:case\"end\":return _context.stop();}}},_callee,null,[[0,9]]);}));return function fetchData(){return _ref.apply(this,arguments);};}();fetchData();},[category,error,order,page,price,query]);var _useState=useState([]),_useState2=_slicedToArray(_useState,2),categories=_useState2[0],setCategories=_useState2[1];useEffect(function(){var fetchCategories=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var instance,_yield$instance$get2,data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;instance=axios.create({baseURL:\"http://localhost:5000\"});_context2.next=4;return instance.get(\"/api/products/categories\");case 4:_yield$instance$get2=_context2.sent;data=_yield$instance$get2.data;setCategories(data);_context2.next=12;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](0);toast.error(getError(_context2.t0));case 12:case\"end\":return _context2.stop();}}},_callee2,null,[[0,9]]);}));return function fetchCategories(){return _ref2.apply(this,arguments);};}();fetchCategories();},[dispatch]);var getFilterUrl=function getFilterUrl(filter){var filterPage=filter.page||page;var filterCategory=filter.category||category;var filterQuery=filter.query||query;// const filterRating = filter.rating || rating;\nvar filterPrice=filter.price||price;var sortOrder=filter.order||order;// return `/search?category=${filterCategory}&query=${filterQuery}&price=${filterPrice}&rating=${filterRating}&order=${sortOrder}&page=${filterPage}`;\nreturn\"/search?category=\".concat(filterCategory,\"&query=\").concat(filterQuery,\"&price=\").concat(filterPrice,\"&order=\").concat(sortOrder,\"&page=\").concat(filterPage);};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Helmet,{children:/*#__PURE__*/_jsx(\"title\",{children:\"Search Products\"})}),/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsxs(Col,{md:3,children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Department\"}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"ul\",{children:[/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsx(Link,{className:'all'===category?'text-bold':'',to:getFilterUrl({category:'all'}),children:\"Any\"})}),categories.map(function(c){return/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsx(Link,{className:c===category?'text-bold':'',to:getFilterUrl({category:c}),children:c})},c);})]})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Price\"}),/*#__PURE__*/_jsxs(\"ul\",{children:[/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsx(Link,{className:'all'===price?'text-bold':'',to:getFilterUrl({price:'all'}),children:\"Any\"})}),prices.map(function(p){return/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsx(Link,{to:getFilterUrl({price:p.value}),className:p.value===price?'text-bold':'',children:p.name})},p.value);})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Avg. Customer Review\"}),/*#__PURE__*/_jsx(\"ul\",{})]})]}),/*#__PURE__*/_jsx(Col,{md:9,children:loading?/*#__PURE__*/_jsx(LoadingBox,{}):error?/*#__PURE__*/_jsx(MessageBox,{variant:\"danger\",children:error}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Row,{className:\"justify-content-between mb-3\",children:[/*#__PURE__*/_jsx(Col,{md:6,children:/*#__PURE__*/_jsxs(\"div\",{children:[countProducts===0?'No':countProducts,\" Results\",query!=='all'&&' : '+query,category!=='all'&&' : '+category,price!=='all'&&' : Price '+price,query!=='all'||category!=='all'||// rating !== 'all' ||\nprice!=='all'?/*#__PURE__*/_jsx(Button,{variant:\"light\",onClick:function onClick(){return navigate('/search');},children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-times-circle\"})}):null]})}),/*#__PURE__*/_jsxs(Col,{className:\"text-end\",children:[\"Sort by\",' ',/*#__PURE__*/_jsxs(\"select\",{value:order,onChange:function onChange(e){navigate(getFilterUrl({order:e.target.value}));},children:[/*#__PURE__*/_jsx(\"option\",{value:\"newest\",children:\"Newest Arrivals\"}),/*#__PURE__*/_jsx(\"option\",{value:\"lowest\",children:\"Price: Low to High\"}),/*#__PURE__*/_jsx(\"option\",{value:\"highest\",children:\"Price: High to Low\"})]})]})]}),products.length===0&&/*#__PURE__*/_jsx(MessageBox,{children:\"No Product Found\"}),/*#__PURE__*/_jsx(Row,{children:products.map(function(product){return/*#__PURE__*/_jsx(Col,{sm:6,lg:4,className:\"mb-3\",children:/*#__PURE__*/_jsx(Product,{product:product})},product._id);})}),/*#__PURE__*/_jsx(\"div\",{children:_toConsumableArray(Array(pages).keys()).map(function(x){return/*#__PURE__*/_jsx(LinkContainer,{className:\"mx-1\",to:getFilterUrl({page:x+1}),children:/*#__PURE__*/_jsx(Button,{className:Number(page)===x+1?'text-bold':'',variant:\"light\",children:x+1})},x+1);})})]})})]})]});}","map":{"version":3,"sources":["/home/akila/Desktop/Caffeine_Confessions_SPE_Final_Project/frontend/src/screens/SearchScreen.js"],"names":["React","useEffect","useReducer","useState","Link","useNavigate","useLocation","axios","toast","getError","Helmet","Row","Col","LoadingBox","MessageBox","Button","Product","LinkContainer","reducer","state","action","type","loading","products","payload","page","pages","countProducts","error","prices","name","value","SearchScreen","navigate","search","sp","URLSearchParams","category","get","query","price","order","dispatch","fetchData","instance","create","baseURL","data","categories","setCategories","fetchCategories","getFilterUrl","filter","filterPage","filterCategory","filterQuery","filterPrice","sortOrder","map","c","p","e","target","length","product","_id","Array","keys","x","Number"],"mappings":"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","sourcesContent":["import React, { useEffect, useReducer, useState } from 'react';\nimport { Link, useNavigate, useLocation } from 'react-router-dom';\nimport axios from 'axios';\nimport { toast } from 'react-toastify';\nimport { getError } from '../utils';\nimport { Helmet } from 'react-helmet-async';\nimport Row from 'react-bootstrap/Row';\nimport Col from 'react-bootstrap/Col';\n// import Rating from '../components/Rating';\nimport LoadingBox from '../components/LoadingBox';\nimport MessageBox from '../components/MessageBox';\nimport Button from 'react-bootstrap/Button';\nimport Product from '../components/Product';\nimport LinkContainer from 'react-router-bootstrap/LinkContainer';\n\nconst reducer = (state, action) => {\n  switch (action.type) {\n    case 'FETCH_REQUEST':\n      return { ...state, loading: true };\n    case 'FETCH_SUCCESS':\n      return {\n        ...state,\n        products: action.payload.products,\n        page: action.payload.page,\n        pages: action.payload.pages,\n        countProducts: action.payload.countProducts,\n        loading: false,\n      };\n    case 'FETCH_FAIL':\n      return { ...state, loading: false, error: action.payload };\n\n    default:\n      return state;\n  }\n};\n\nconst prices = [\n  {\n    name: '$1 to $50',\n    value: '1-50',\n  },\n  {\n    name: '$51 to $200',\n    value: '51-200',\n  },\n  {\n    name: '$201 to $1000',\n    value: '201-1000',\n  },\n];\n\n// export const ratings = [\n//   {\n//     name: '4stars & up',\n//     rating: 4,\n//   },\n\n//   {\n//     name: '3stars & up',\n//     rating: 3,\n//   },\n\n//   {\n//     name: '2stars & up',\n//     rating: 2,\n//   },\n\n//   {\n//     name: '1stars & up',\n//     rating: 1,\n//   },\n// ];\n\nexport default function SearchScreen() {\n  const navigate = useNavigate();\n  const { search } = useLocation();\n  const sp = new URLSearchParams(search); // /search?category=Shirts\n  const category = sp.get('category') || 'all';\n  const query = sp.get('query') || 'all';\n  const price = sp.get('price') || 'all';\n  // const rating = sp.get('rating') || 'all';\n  const order = sp.get('order') || 'newest';\n  const page = sp.get('page') || 1;\n\n  const [{ loading, error, products, pages, countProducts }, dispatch] =\n    useReducer(reducer, {\n      loading: true,\n      error: '',\n    });\n\n  useEffect(() => {\n    const fetchData = async () => {\n      try {\n        const instance = axios.create({baseURL:\"http://localhost:5000\"})\n        const { data } = await instance.get(\n          // `/api/products/search?page=${page}&query=${query}&category=${category}&price=${price}&rating=${rating}&order=${order}`\n          `/api/products/search?page=${page}&query=${query}&category=${category}&price=${price}&order=${order}`\n        );\n        dispatch({ type: 'FETCH_SUCCESS', payload: data });\n      } catch (err) {\n        dispatch({\n          type: 'FETCH_FAIL',\n          payload: getError(error),\n        });\n      }\n    };\n    fetchData();\n  }, [category, error, order, page, price, query]);\n\n  const [categories, setCategories] = useState([]);\n  useEffect(() => {\n    const fetchCategories = async () => {\n      try {\n        const instance = axios.create({baseURL:\"http://localhost:5000\"})\n        const { data } = await instance.get(`/api/products/categories`);\n        setCategories(data);\n      } catch (err) {\n        toast.error(getError(err));\n      }\n    };\n    fetchCategories();\n  }, [dispatch]);\n\n  const getFilterUrl = (filter) => {\n    const filterPage = filter.page || page;\n    const filterCategory = filter.category || category;\n    const filterQuery = filter.query || query;\n    // const filterRating = filter.rating || rating;\n    const filterPrice = filter.price || price;\n    const sortOrder = filter.order || order;\n    // return `/search?category=${filterCategory}&query=${filterQuery}&price=${filterPrice}&rating=${filterRating}&order=${sortOrder}&page=${filterPage}`;\n    return `/search?category=${filterCategory}&query=${filterQuery}&price=${filterPrice}&order=${sortOrder}&page=${filterPage}`;\n  };\n  return (\n    <div>\n      <Helmet>\n        <title>Search Products</title>\n      </Helmet>\n      <Row>\n        <Col md={3}>\n          <h3>Department</h3>\n          <div>\n            <ul>\n              <li>\n                <Link\n                  className={'all' === category ? 'text-bold' : ''}\n                  to={getFilterUrl({ category: 'all' })}\n                >\n                  Any\n                </Link>\n              </li>\n              {categories.map((c) => (\n                <li key={c}>\n                  <Link\n                    className={c === category ? 'text-bold' : ''}\n                    to={getFilterUrl({ category: c })}\n                  >\n                    {c}\n                  </Link>\n                </li>\n              ))}\n            </ul>\n          </div>\n          <div>\n            <h3>Price</h3>\n            <ul>\n              <li>\n                <Link\n                  className={'all' === price ? 'text-bold' : ''}\n                  to={getFilterUrl({ price: 'all' })}\n                >\n                  Any\n                </Link>\n              </li>\n              {prices.map((p) => (\n                <li key={p.value}>\n                  <Link\n                    to={getFilterUrl({ price: p.value })}\n                    className={p.value === price ? 'text-bold' : ''}\n                  >\n                    {p.name}\n                  </Link>\n                </li>\n              ))}\n            </ul>\n          </div>\n          <div>\n            <h3>Avg. Customer Review</h3>\n            <ul>\n              {/* {ratings.map((r) => (\n                <li key={r.name}>\n                  <Link\n                    to={getFilterUrl({ rating: r.rating })}\n                    className={`${r.rating}` === `${rating}` ? 'text-bold' : ''}\n                  >\n                    <Rating caption={' & up'} rating={r.rating}></Rating>\n                  </Link>\n                </li>\n              ))} */}\n              {/* <li>\n                <Link\n                  to={getFilterUrl({ rating: 'all' })}\n                  className={rating === 'all' ? 'text-bold' : ''}\n                >\n                  <Rating caption={' & up'} rating={0}></Rating>\n                </Link>\n              </li> */}\n            </ul>\n          </div>\n        </Col>\n        <Col md={9}>\n          {loading ? (\n            <LoadingBox></LoadingBox>\n          ) : error ? (\n            <MessageBox variant=\"danger\">{error}</MessageBox>\n          ) : (\n            <>\n              <Row className=\"justify-content-between mb-3\">\n                <Col md={6}>\n                  <div>\n                    {countProducts === 0 ? 'No' : countProducts} Results\n                    {query !== 'all' && ' : ' + query}\n                    {category !== 'all' && ' : ' + category}\n                    {price !== 'all' && ' : Price ' + price}\n                    {/* {rating !== 'all' && ' : Rating ' + rating + ' & up'} */}\n                    {query !== 'all' ||\n                    category !== 'all' ||\n                    // rating !== 'all' ||\n                    price !== 'all' ? (\n                      <Button\n                        variant=\"light\"\n                        onClick={() => navigate('/search')}\n                      >\n                        <i className=\"fas fa-times-circle\"></i>\n                      </Button>\n                    ) : null}\n                  </div>\n                </Col>\n                <Col className=\"text-end\">\n                  Sort by{' '}\n                  <select\n                    value={order}\n                    onChange={(e) => {\n                      navigate(getFilterUrl({ order: e.target.value }));\n                    }}\n                  >\n                    <option value=\"newest\">Newest Arrivals</option>\n                    <option value=\"lowest\">Price: Low to High</option>\n                    <option value=\"highest\">Price: High to Low</option>\n                    {/* <option value=\"toprated\">Avg. Customer Reviews</option> */}\n                  </select>\n                </Col>\n              </Row>\n              {products.length === 0 && (\n                <MessageBox>No Product Found</MessageBox>\n              )}\n\n              <Row>\n                {products.map((product) => (\n                  <Col sm={6} lg={4} className=\"mb-3\" key={product._id}>\n                    <Product product={product}></Product>\n                  </Col>\n                ))}\n              </Row>\n\n              <div>\n                {[...Array(pages).keys()].map((x) => (\n                  <LinkContainer\n                    key={x + 1}\n                    className=\"mx-1\"\n                    to={getFilterUrl({ page: x + 1 })}\n                  >\n                    <Button\n                      className={Number(page) === x + 1 ? 'text-bold' : ''}\n                      variant=\"light\"\n                    >\n                      {x + 1}\n                    </Button>\n                  </LinkContainer>\n                ))}\n              </div>\n            </>\n          )}\n        </Col>\n      </Row>\n    </div>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}